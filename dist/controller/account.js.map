{"version":3,"sources":["../../src/controller/account.js"],"names":["config","db","api","get","req","res","status","send","username","body","post","Account","findOne","email","err","user","msg","acc","console","log","save","error","passport","authenticate","session","scope"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;AAGA;;;;kBAEe,gBAAoB;AAAA,QAAjBA,MAAiB,QAAjBA,MAAiB;AAAA,QAATC,EAAS,QAATA,EAAS;;AAC/B,QAAIC,MAAM,sBAAV;;AAEAA,QAAIC,GAAJ,CAAQ,GAAR,EAAa,UAACC,GAAD,EAAKC,GAAL,EAAa;AACtBA,YAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,UAAUJ,IAAIK,IAAJ,CAASD,QAApB,EAArB;AACH,KAFD;;AAIA;;AAEAN,QAAIQ,IAAJ,CAAS,WAAT,EAAsB,UAACN,GAAD,EAAMC,GAAN,EAAc;;AAEhC;AACAM,0BAAQC,OAAR,CAAgB,EAACC,OAAOT,IAAIK,IAAJ,CAASI,KAAjB,EAAhB,EAAyC,UAASC,GAAT,EAAcC,IAAd,EAAoB;AACzD,gBAAGA,IAAH,EAAS,OAAOV,IAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACS,KAAK,qCAAN,EAArB,CAAP;AACT,gBAAGF,GAAH,EAAQ,OAAOT,IAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACS,KAAK,wBAAN,EAArB,CAAP;;AAER,gBAAIC,MAAM,IAAIN,iBAAJ,CAAYP,IAAIK,IAAhB,CAAV;AACAS,oBAAQC,GAAR,CAAYF,GAAZ;AACAA,gBAAIG,IAAJ,CAAS,UAACC,KAAD,EAAW;AAChB,oBAAGA,KAAH,EAAS;AACL,2BAAOhB,IAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACS,KAAK,sBAAN,EAArB,CAAP;AACH;AACD,uBAAOX,IAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACS,KAAK,iCAAN,EAArB,CAAP;AACH,aALD;AAMH,SAZD;AAaH,KAhBD;;AAkBA;AACAd,QAAIQ,IAAJ,CAAS,QAAT,EAAmB,UAACN,GAAD,EAAKC,GAAL,EAAa;AAC5BM,0BAAQC,OAAR,CAAgB,EAACC,OAAOT,IAAIK,IAAJ,CAASI,KAAjB,EAAhB,EAAyC,UAASC,GAAT,EAAcC,IAAd,EAAoB;AAC7D,gBAAG,CAACA,IAAJ,EAAU,OAAOV,IAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACS,KAAK,uBAAN,EAArB,CAAP;;AAEVM,+BAASC,YAAT,CACI,OADJ,EACa;AACLC,yBAAS,IADJ;AAELC,uBAAO;AAFF,aADb;AAKI,qDAAoBV,IAApB;AACA,yCAAQA,IAAR,EAAcV,GAAd;AACH,SAVD;AAWH,KAZD;;AAeA,WAAOH,GAAP;AACH,C","file":"account.js","sourcesContent":["import {Router} from 'express'\nimport Account from '../models/account'\nimport passport from 'passport';\n\n\nimport {generateAccessToken, respond, authenticate} from '../middleware/authMiddleware';\n\nexport default ({ config, db }) => {\n    let api = Router();\n\n    api.get('/', (req,res) => {\n        res.status(200).send({username: req.body.username})\n    })\n\n    // register route\n\n    api.post('/register', (req, res) => {\n\n        // check if user with that email exits\n        Account.findOne({email: req.body.email}, function(err, user) {\n            if(user) return res.status(400).send({msg: 'There is an account with this email'});\n            if(err) return res.status(500).send({msg: 'Something went wrong 1'})\n        \n            let acc = new Account(req.body);\n            console.log(acc)\n            acc.save((error) => {\n                if(error){\n                    return res.status(500).send({msg: 'Something went wrong'})\n                }\n                return res.status(200).send({msg: 'Account was succesfully Created'})\n            })\n        })\n    })\n\n    // login route\n    api.post('/login', (req,res) => {\n        Account.findOne({email: req.body.email}, function(err, user) {\n        if(!user) return res.status(400).send({msg: \"Username doesnt exits\"})\n        \n        passport.authenticate(\n            'local', {\n                session: true,\n                scope: []\n            })\n            generateAccessToken(user)\n            respond(user, res)\n        })\n    });\n    \n\n    return api;\n}"]}